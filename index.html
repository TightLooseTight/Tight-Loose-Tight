<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tight–Loose–Tight Kalkulator</title>

  <!-- iPhone homescreen / PWA hooks -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TLT Kalkulator">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0a7cff" />

  <style>
    :root{
      --brand:#0a7cff; --brand-2:#5cc8ff;
      --bg:#0a0f1a; --card:#101828; --muted:#9aa4b2; --text:#eef2f7;
      --ok:#10b981; --warn:#f59e0b; --bad:#ef4444; --radius:16px; --disabled:#1a2234;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 90% -10%, rgba(10,124,255,.25), transparent 60%),
        radial-gradient(1000px 600px at 10% 110%, rgba(92,200,255,.25), transparent 60%),
        linear-gradient(180deg, #0b1220 0%, #0a0f1a 60%, #070b12 100%);
      min-height:100%;
    }
    .wrap{max-width:980px;margin:0 auto;padding:24px clamp(16px,4vw,28px) 80px}
    header{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:18px;text-align:center}

    .logo{width:132px;height:132px;border-radius:12px;background:#0b1322;border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo img{max-width:100%;max-height:100%;object-fit:contain}

    .title{font-size:clamp(26px,4.8vw,38px);font-weight:800;text-align:center}
    .subtitle{color:var(--muted);line-height:1.5}

    .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.07);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.35);backdrop-filter:blur(6px)}
    .card-inner{padding:clamp(16px,2.8vw,24px)}
    .row{display:grid;gap:12px}

    .lang{display:flex;gap:16px;align-items:center;justify-content:center}
    .flag{
      width:160px; height:106px; /* 3:2 */
      border-radius:8px; border:1px solid rgba(255,255,255,.2);
      cursor:pointer; opacity:.95; background:#0b1322;
    }
    .flag.active{ outline:2px solid var(--brand); opacity:1; }

    .nav-arrows{display:flex;justify-content:space-between;gap:12px;margin-top:18px}
    #p1-prev{display:none} /* ingen "Tilbake" på side 1 */
    #p5-next{display:none} /* ingen "Neste" på side 5 */
    .arrow{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0b1322;color:var(--text);cursor:pointer}

    .btn{padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,#0e1a33,#0b1322);color:var(--text);cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(180deg,var(--brand),var(--brand-2));color:#041123;border-color:transparent}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.2)}
    .btn[disabled]{opacity:.5;cursor:not-allowed}

    .field{display:grid;gap:8px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1322;color:var(--text);outline:none}
    .name-row{display:flex;gap:10px;align-items:center}
    .pencil{cursor:pointer;opacity:.8}

    .accordion{display:grid;gap:12px}
    .acc-item{border:1px solid rgba(255,255,255,.08);border-radius:14px;background:#0c1527}
    .acc-hd{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;cursor:pointer}
    .acc-hd h3{margin:0;font-size:16px}
    .acc-bd{display:none;padding:0 16px 16px 16px}
    .acc-item.open .acc-bd{display:block}

    .q{padding:12px;border-radius:12px;border:1px dashed rgba(255,255,255,.12);margin-top:10px}
    .q p{margin:0 0 10px 0}
    .scale{display:flex;gap:8px;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;justify-content:center;min-width:42px;padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#0b1322;color:var(--text);cursor:pointer}
    .pill.active{background:rgba(10,124,255,.30);border-color:var(--brand)}

    .scorebox{display:grid;gap:10px;grid-template-columns:repeat(3,1fr)}
    .score{text-align:center;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0c1527}
    .score.disabled{background:var(--disabled);opacity:.7}
    .score h4{margin:2px 0 6px 0;color:var(--muted);font-weight:600}
    .score .big{font-size:28px;font-weight:900}
    .badge{font-weight:800;padding:2px 8px;border-radius:999px}
    .ok{background:rgba(16,185,129,.2);color:#d1fae5;border:1px solid rgba(16,185,129,.4)}
    .warn{background:rgba(245,158,11,.2);color:#fef3c7;border:1px solid rgba(245,158,11,.4)}
    .bad{background:rgba(239,68,68,.2);color:#fee2e2;border:1px solid rgba(239,68,68,.4)}

    footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}
    .hidden{display:none!important}

    /* Side 1: senter flagg og tekst */
    #page-1 .row{place-items:center;text-align:center}
    #p1-text{width:100%;text-align:center}

    /* Info-side typografi */
    .lead{font-size:clamp(16px,2.2vw,19px); color:#d9e2ef}
    .muted{color:var(--muted)}
    .bullets{margin:0; padding-left:18px}
    .bullets li{margin:6px 0}

    /* Radar chart (side 5) */
    .radar-wrap{margin:16px 0 8px 0}
    .radar-card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.07);
      border-radius:14px;
      padding:12px
    }
    .radar-legend{
      display:flex;gap:16px;align-items:center;justify-content:center;
      color:var(--muted);font-size:13px;margin-top:6px
    }
    .legend-dot{width:10px;height:10px;border-radius:999px;display:inline-block;border:1px solid rgba(255,255,255,.4)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" title="Bytt ut logo.png i repoet for firmalogo">
        <img id="logo" src="logo.png" alt="Company Logo"
             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2244%22 height=%2244%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%230b1322%22/%3E%3Ctext x=%2250%25%22 y=%2256%25%22 text-anchor=%22middle%22 font-size=%2220%22 fill=%22%239aa4b2%22 font-family=%22Arial%22%3ELOGO%3C/text%3E%3C/svg%3E'">
      </div>
      <div class="title">Tight–Loose–Tight</div>
      <div class="subtitle" id="subtitle">Refleksjonsverktøy for lederstil</div>
    </header>

    <div class="card">
      <div class="card-inner">

        <!-- PAGE 1: språkvalg -->
        <div id="page-1" class="page">
          <div class="row" style="gap:14px">
            <div class="lang">
              <img id="flag-no" class="flag"
                   src="./flags/no.png" alt="Norsk" title="Norsk"
                   onerror="this.onerror=null;this.src='https://flagcdn.com/w160/no.png'">
              <img id="flag-dk" class="flag"
                   src="./flags/dk.png" alt="Dansk" title="Dansk"
                   onerror="this.onerror=null;this.src='https://flagcdn.com/w160/dk.png'">
                <img id="flag-se" class="flag"
       src="./flags/se.png" alt="Svensk" title="Svensk"
       onerror="this.onerror=null;this.src='https://flagcdn.com/w160/se.png'">
            </div>
            <p id="p1-text" class="subtitle">Velg språk og gå videre.</p>
            <div class="nav-arrows">
              <button class="arrow" id="p1-prev">← Tilbake</button>
              <button class="arrow" id="p1-next">Neste →</button>
            </div>
          </div>
        </div>

        <!-- PAGE 2: ny info-side -->
        <div id="page-2" class="page hidden">
          <div class="row">
            <h2 id="info-h1">Om denne selvtesten</h2>
            <p class="lead" id="info-lead">
              Dette er et enkelt refleksjonsverktøy – ikke en fasit. Hensikten er å gi deg et språk
              og et utgangspunkt for samtale om ledelse, ikke å “måle” deg.
            </p>
            <p id="info-p1">
              Metodikken bygger på <strong>Tight–Loose–Tight</strong>-rammeverket (TLT): først tydelig retning og rammer
              (Tight), deretter reell autonomi og eierskap i gjennomføringen (Loose), og til slutt systematisk
              oppfølging, kvalitet og læring (Tight).
            </p>
            <ul class="bullets" id="info-ul">
              <li><strong>Selvtest:</strong> Du vurderer deg selv – resultatene lagres kun lokalt på enheten din.</li>
              <li><strong>Samtalestarter:</strong> Testen er laget for dialog og refleksjon, ikke for sertifisering.</li>
              <li><strong>Praktisk:</strong> Skårene peker på hva du kan forsterke eller justere i hverdagen.</li>
              <li><strong>Effekt:</strong> Balanse mellom styring, autonomi og oppfølging gir fart, læring og kvalitet.</li>
            </ul>
            <p class="muted" id="info-foot">
              Tips: Gjør testen raskt første gang, diskuter i gruppe, og vend tilbake etter noen uker for å se utvikling.
            </p>

            <div class="nav-arrows">
              <button class="arrow" id="p2-prev">← Tilbake</button>
              <button class="arrow" id="p2-next">Neste →</button>
            </div>
          </div>
        </div>

        <!-- PAGE 3: navn -->
        <div id="page-3" class="page hidden">
          <div class="row" style="gap:14px">
            <div class="field">
              <label for="name" id="lbl-name">Skriv inn ditt navn</label>
              <div class="name-row">
                <input id="name" type="text" placeholder="Skriv navnet ditt…" />
                <button class="btn ghost" id="btn-ok">OK</button>
                <span id="btn-edit" class="pencil" title="Rediger" aria-label="Rediger navn">✎</span>
              </div>
              <small class="subtitle" id="p3-help">Navnet lagres lokalt på enheten og brukes i resultatene.</small>
            </div>
            <div class="nav-arrows">
              <button class="arrow" id="p3-prev">← Tilbake</button>
              <button class="arrow" id="p3-next">Neste →</button>
            </div>
          </div>
        </div>

        <!-- PAGE 4: test (3×5 spørsmål) -->
        <div id="page-4" class="page hidden">
          <h2 id="p4-title">Test deg selv</h2>
          <div class="accordion" id="acc"></div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
            <button class="btn primary" id="btn-calc">Oppdater resultater</button>
            <button class="btn" id="btn-readmore">Les resultater</button>
            <button class="btn ghost" id="btn-reset">Nullstill</button>
          </div>
          <div class="scorebox" style="margin-top:14px">
            <div class="score disabled" id="sb-t1">
              <h4>Tight (1)</h4><div class="big" id="sbv-t1">–</div><div class="muted" id="sbb-t1">–</div>
            </div>
            <div class="score disabled" id="sb-loose">
              <h4>Loose</h4><div class="big" id="sbv-loose">–</div><div class="muted" id="sbb-loose">–</div>
            </div>
            <div class="score disabled" id="sb-t2">
              <h4>Tight (2)</h4><div class="big" id="sbv-t2">–</div><div class="muted" id="sbb-t2">–</div>
            </div>
          </div>
          <div class="nav-arrows">
            <button class="arrow" id="p4-prev">← Tilbake</button>
            <button class="arrow" id="p4-next">Neste →</button>
          </div>
        </div>

        <!-- PAGE 5: resultater + radar (maks 25) -->
        <div id="page-5" class="page hidden">
          <h2 id="p5-title">Her er dine resultater <span id="userNameInline"></span></h2>
          <div class="scorebox" style="margin:10px 0 16px 0;grid-template-columns:1fr">
            <div class="score disabled" id="r-t1">
              <h4>Tight (1)</h4><div class="big" id="rv-t1">–</div><div class="muted" id="rb-t1">–</div>
              <p id="rt-t1" class="subtitle" style="margin-top:8px"></p>
            </div>
            <div class="score disabled" id="r-loose">
              <h4>Loose</h4><div class="big" id="rv-loose">–</div><div class="muted" id="rb-loose">–</div>
              <p id="rt-loose" class="subtitle" style="margin-top:8px"></p>
            </div>
            <div class="score disabled" id="r-t2">
              <h4>Tight (2)</h4><div class="big" id="rv-t2">–</div><div class="muted" id="rb-t2">–</div>
              <p id="rt-t2" class="subtitle" style="margin-top:8px"></p>
            </div>
          </div>

          <!-- Radar chart -->
          <div id="radar" class="radar-wrap hidden">
            <div class="radar-card">
              <svg id="radarSvg" viewBox="0 0 360 360" width="100%" height="auto" aria-label="Spindeldiagram"></svg>
              <div class="radar-legend">
                <span><span class="legend-dot" style="background:rgba(10,124,255,.6);border-color:var(--brand)"></span> Min score</span>
                <span><span class="legend-dot" style="background:transparent;border-color:var(--brand-2)"></span> Maks (25)</span>
              </div>
            </div>
          </div>

          <div class="nav-arrows">
            <button class="arrow" id="p5-prev">← Tilbake</button>
            <button class="arrow" id="p5-next">Neste →</button>
          </div>
        </div>
        <!-- END PAGES -->

      </div>
    </div>

    <footer id="ft">Tips: Legg på hjem-skjerm via Del → «Legg til på Hjem-skjerm».</footer>
  </div>

  <script>
    // ---- Localization ----
    const L = {
      no: {
        subtitle:"Refleksjonsverktøy for lederstil",
        p1:"Velg språk og gå videre.",
        info_h1:"Om denne selvtesten",
        info_lead:"Dette er et enkelt refleksjonsverktøy – ikke en fasit. Hensikten er å gi deg et språk og et utgangspunkt for samtale om ledelse, ikke å “måle” deg.",
        info_p1:"Metodikken bygger på Tight–Loose–Tight-rammeverket (TLT): først tydelig retning og rammer (Tight), deretter reell autonomi og eierskap i gjennomføringen (Loose), og til slutt systematisk oppfølging, kvalitet og læring (Tight).",
        info_ul: [
          "Selvtest: Du vurderer deg selv – resultatene lagres kun lokalt på enheten din.",
          "Samtalestarter: Testen er laget for dialog og refleksjon, ikke for sertifisering.",
          "Praktisk: Skårene peker på hva du kan forsterke eller justere i hverdagen.",
          "Effekt: Balanse mellom styring, autonomi og oppfølging gir fart, læring og kvalitet."
        ],
        info_foot:"Tips: Gjør testen raskt første gang, diskuter i gruppe, og vend tilbake etter noen uker for å se utvikling.",
        nameLbl:"Skriv inn ditt navn",
        nameHelp:"Navnet lagres lokalt på enheten og brukes i resultatene.",
        testYourself:"Test deg selv", update:"Oppdater resultater", readmore:"Les resultater", reset:"Nullstill",
        resultsTitle:(n)=>`Her er dine resultater${n?` (${n})`:''}`,
        badges:{ strong:"Sterk", balanced:"Balansert", weak:"Svak" },
      },
      dk: {
        subtitle:"Refleksionsværktøj for lederstil",
        p1:"Vælg sprog og gå videre.",
        info_h1:"Om denne selvtest",
        info_lead:"Dette er et enkelt refleksionsværktøj – ikke en facitliste. Formålet er at give dig et sprog og et afsæt for dialog om ledelse – ikke at måle dig.",
        info_p1:"Metoden bygger på Tight–Loose–Tight (TLT): først tydelig retning og rammer (Tight), dernæst reel autonomi og ejerskab i gennemførsel (Loose), og til sidst systematisk opfølgning, kvalitet og læring (Tight).",
        info_ul: [
          "Selvtest: Du vurderer dig selv – resultaterne gemmes kun lokalt på din enhed.",
          "Samtalestarter: Testen er til dialog og refleksion – ikke certificering.",
          "Praktisk: Scorerne peger på, hvad du kan forstærke eller justere i hverdagen.",
          "Effekt: Balance mellem styring, autonomi og opfølgning giver fart, læring og kvalitet."
        ],
        info_foot:"Tip: Lav testen hurtigt første gang, drøft i grupper, og vend tilbage efter nogle uger for at se udvikling.",
        nameLbl:"Skriv dit navn",
        nameHelp:"Navnet gemmes lokalt på enheden og bruges i resultaterne.",
        testYourself:"Test dig selv", update:"Opdater resultater", readmore:"Læs resultater", reset:"Nulstil",
        resultsTitle:(n)=>`Her er dine resultater${n?` (${n})`:''}`,
        badges:{ strong:"Stærk", balanced:"Afbalanceret", weak:"Svag" },
      }
    };

    // ---- Questions (3×5) ----
    const QUESTIONS = {
      t1:[
        "Jeg sikrer at teamet forstår mål, prioriteringer og forventede leveranser.",
        "Jeg definerer roller og ansvar slik at alle vet sitt bidrag.",
        "Jeg kommuniserer standarder, frister og kvalitetskrav tydelig.",
        "Jeg etablerer tydelige beslutningsarenaer og avklarer hvem som beslutter hva.",
        "Jeg setter tydelige rammer (scope/ikke-scope) og kriterier for «definition of done»."
      ],
      loose:[
        "Jeg gir frihet til å løse oppgaver innenfor avtalte rammer.",
        "Jeg skaper trygghet for å eksperimentere, ta risiko og foreslå nye ideer.",
        "Jeg stoler på at teamet tar beslutninger selvstendig, og griper kun inn ved behov.",
        "Jeg fjerner hindringer og beskytter fokus slik at teamet kan levere på egne valg.",
        "Jeg inviterer til læring underveis (demoer, deling), ikke bare ved slutt."
      ],
      t2:[
        "Jeg følger opp progresjon systematisk og gir konstruktive tilbakemeldinger.",
        "Jeg sikrer at leveranser holder avtalte standarder, og adresserer avvik raskt.",
        "Jeg feirer prestasjoner og bruker utfordringer til læring og forbedring.",
        "Jeg gjør målbar effekt synlig (før/etter) og korrigerer kurs basert på data.",
        "Jeg lukker løkker: tydelige neste steg og eierskap etter hver review."
      ]
    };

    // ---- Felles resultat-tekster (samme for T/L/T) ----
    function evalTextGeneric(score, name, lang='no'){
      const weak = score < 13;      // ~<52% av 25
      const strong = score >= 20;   // >=80% av 25
      const n = name || (lang==='dk'?'Du':'Du');
      const T = {
        no:{
          weak: `${n}, her har du litt å jobbe med. Prioritér denne delen de neste ukene: gjør én konkret endring, test i liten skala, og be om tilbakemeldinger.`,
          mid:  `${n}, du er på god vei. Velg 1–2 vaner å forsterke, og gjør dem synlige for teamet (f.eks. sjekkliste, demo eller fast review).`,
          strong:`${n}, dette er et tydelig styrkeområde. Hold nivået ved å gjøre det repeterbart (enkle standarder/ritualer) og del praksisen med andre.`
        },
        dk:{
          weak: `${n}, her er der noget at arbejde med. Prioritér dette område de næste uger: lav én konkret ændring, test i lille skala, og bed om feedback.`,
          mid:  `${n}, du er godt på vej. Vælg 1–2 vaner at forstærke, og gør dem synlige for teamet (fx tjekliste, demo eller fast review).`,
          strong:`${n}, dette er et klart styrkeområde. Hold niveauet ved at gøre det gentageligt (enkle standarder/ritualer) og del praksis med andre.`
        }
      };
      if (strong) return T[lang].strong;
      if (weak)   return T[lang].weak;
      return T[lang].mid;
    }

    // ---- State ----
    const STATE_KEY = 'tlt_calc_v3_3x5';
    let st = { lang:'no', name:'', answers:{ t1:Array(5).fill(null), loose:Array(5).fill(null), t2:Array(5).fill(null) }, expanded:{t1:false,loose:false,t2:false} };
    const $=q=>document.querySelector(q);

    function save(){ try{ localStorage.setItem(STATE_KEY, JSON.stringify(st)); }catch{} }
    function load(){
      try{ const raw = localStorage.getItem(STATE_KEY); if(raw) st = JSON.parse(raw); }catch{}
      applyLang();
      const nameEl = $('#name'); if (nameEl) nameEl.value = st.name || '';
      const inline = $('#userNameInline'); if (inline) inline.textContent = st.name? st.name : '';
      renderAccordion();
      Object.entries(st.answers).forEach(([k,arr])=>arr.forEach((v,i)=>{
        if(v){ const el=document.querySelector(`.pill[data-q="${k}-${i}"][data-v="${v}"]`); if(el) el.classList.add('active'); }
      }));
      updateScoreboxes(false);
    }

    function applyLang(){
      const t=L[st.lang];
      $('#subtitle').textContent=t.subtitle;
      $('#p1-text').textContent=t.p1;

      // Info side
      $('#info-h1').textContent = t.info_h1;
      $('#info-lead').textContent = t.info_lead;
      $('#info-p1').textContent = t.info_p1;
      const ul = document.getElementById('info-ul'); ul.innerHTML='';
      t.info_ul.forEach(item => { const li=document.createElement('li'); li.textContent=item; ul.appendChild(li); });
      $('#info-foot').textContent = t.info_foot;

      // Navn & test
      $('#lbl-name').textContent=t.nameLbl;
      $('#p3-help').textContent=t.nameHelp;
      $('#p4-title').textContent=t.testYourself;
      $('#btn-calc').textContent=t.update;
      $('#btn-readmore').textContent=t.readmore;
      $('#btn-reset').textContent=t.reset;
      $('#p5-title').textContent=t.resultsTitle(st.name);
    }

    // Nav mellom sider (1→2→3→4→5)
    function showPage(i){ document.querySelectorAll('.page').forEach((p,idx)=>p.classList.toggle('hidden', idx!==i-1)); }

    // Språkvalg
    document.addEventListener('click', (e)=>{
      if(e.target && e.target.id==='flag-no'){ st.lang='no'; save(); applyLang(); $('#flag-no').classList.add('active'); $('#flag-dk').classList.remove('active'); }
      if(e.target && e.target.id==='flag-dk'){ st.lang='dk'; save(); applyLang(); $('#flag-dk').classList.add('active'); $('#flag-no').classList.remove('active'); }
    });
    function setFlag(){ $('#flag-no')?.classList.toggle('active', st.lang==='no'); $('#flag-dk')?.classList.toggle('active', st.lang==='dk'); }

    // Navigasjon
    $('#p1-next').addEventListener('click', ()=> showPage(2));
    $('#p2-prev').addEventListener('click', ()=> showPage(1));
    $('#p2-next').addEventListener('click', ()=> showPage(3));
    $('#p3-prev').addEventListener('click', ()=> showPage(2));
    $('#p3-next').addEventListener('click', ()=> showPage(4));
    $('#p4-prev').addEventListener('click', ()=> showPage(3));
    $('#p4-next').addEventListener('click', ()=> showPage(5));
    $('#p5-prev').addEventListener('click', ()=> showPage(4));

    // Navn
    $('#btn-ok').addEventListener('click', ()=>{ st.name=$('#name').value.trim(); save(); const i=$('#userNameInline'); if(i) i.textContent=st.name||''; toast(st.lang==='dk'?'Navn opdateret':'Navn oppdatert'); });
    $('#btn-edit').addEventListener('click', ()=>{ const n=$('#name'); n?.focus(); n?.select(); });

    // Accordion (3×5)
    function renderAccordion(){
      const acc=$('#acc'); if(!acc) return; acc.innerHTML='';
      [['t1','Tight (1)'],['loose','Loose'],['t2','Tight (2)']].forEach(([key,label])=>{
        const it=document.createElement('div'); it.className='acc-item'+(st.expanded[key]?' open':'');
        it.innerHTML = `
          <div class="acc-hd" data-key="${key}"><h3>${label}</h3><span>${st.expanded[key]?'−':'+'}</span></div>
          <div class="acc-bd">
            ${QUESTIONS[key].map((text,idx)=>`
              <div class="q">
                <p><strong>${idx+1}.</strong> ${text}</p>
                <div class="scale" role="group" aria-label="Skala for ${key}-${idx}">
                  ${[1,2,3,4,5].map(v=>`<span class="pill" data-q="${key}-${idx}" data-v="${v}" tabindex="0">${v}</span>`).join('')}
                </div>
              </div>
            `).join('')}
          </div>`;
        acc.appendChild(it);
      });
    }

    document.body.addEventListener('click',(e)=>{
      const hd=e.target.closest?.('.acc-hd');
      if(hd){ const k=hd.dataset.key; st.expanded[k]=!st.expanded[k]; save(); renderAccordion();
        Object.entries(st.answers).forEach(([key,arr])=>arr.forEach((v,i)=>{ if(v){ const el=document.querySelector(`.pill[data-q="${key}-${i}"][data-v="${v}"]`); if(el) el.classList.add('active'); } }));
        return;
      }
      const pill=e.target.closest?.('.pill');
      if(pill){ const q=pill.dataset.q, v=Number(pill.dataset.v);
        document.querySelectorAll(`.pill[data-q="${q}"]`).forEach(p=>p.classList.remove('active'));
        pill.classList.add('active');
        const [key,idx]=q.split('-'); st.answers[key][Number(idx)]=v; save(); return;
      }
    });

    function sum(a){return a.reduce((x,v)=>x+(Number(v)||0),0);}
    function badge25(score, lang){
      // felles terskler for alle tre kategorier
      if(score >= 20) return {t:L[lang].badges.strong, cls:'ok'};
      if(score >= 13) return {t:L[lang].badges.balanced, cls:'warn'};
      return {t:L[lang].badges.weak, cls:'bad'};
    }

    function updateScoreboxes(hideQuestions){
      const s1=sum(st.answers.t1), sL=sum(st.answers.loose), s2=sum(st.answers.t2);
      [['t1',s1],['loose',sL],['t2',s2]].forEach(([k,s])=>{
        const sb=document.getElementById('sb-'+k), sbb=document.getElementById('sbb-'+k), sbv=document.getElementById('sbv-'+k);
        if(s>0){ sb.classList.remove('disabled'); const b=badge25(s, st.lang); sbb.innerHTML=`<span class="badge ${b.cls}">${b.t}</span>`; sbv.textContent=`${s}/25`; }
        else { sb.classList.add('disabled'); sbb.textContent='–'; sbv.textContent='–'; }
      });
      if(hideQuestions){ st.expanded={t1:false,loose:false,t2:false}; save(); renderAccordion(); }
      fillResultsPage();
    }

    function fillResultsPage(){
      const scores = { t1: sum(st.answers.t1), loose: sum(st.answers.loose), t2: sum(st.answers.t2) };
      const inline=$('#userNameInline'); if(inline) inline.textContent = st.name || '';

      Object.entries(scores).forEach(([k,s])=>{
        const r=document.getElementById('r-'+k), rv=document.getElementById('rv-'+k),
              rb=document.getElementById('rb-'+k), rt=document.getElementById('rt-'+k);
        if(s>0){
          r.classList.remove('disabled');
          const b=badge25(s, st.lang);
          rb.innerHTML=`<span class="badge ${b.cls}">${b.t}</span>`;
          rv.textContent=`${s}/25`;
          rt.textContent=evalTextGeneric(s, st.name, st.lang);
        } else {
          r.classList.add('disabled');
          rb.textContent='–'; rv.textContent='–'; rt.textContent='';
        }
      });

      // Radar trygt: vis kun når noe er besvart
      const any = scores.t1>0 || scores.loose>0 || scores.t2>0;
      const radar = document.getElementById('radar');
      const svg   = document.getElementById('radarSvg');
      if (radar) radar.classList.toggle('hidden', !(any && svg));
      if (any && svg){
        try { drawRadar(scores); }
        catch(e){ console.warn('Radar disabled due to error:', e); radar?.classList.add('hidden'); }
      }
    }

    // Radar-tegner (maks 25)
    function drawRadar(scores){
      const svg = document.getElementById('radarSvg');
      if(!svg) return;

      const cx=180, cy=190, R=130, rings=5, NS='http://www.w3.org/2000/svg';
      svg.innerHTML='';

      const toXY = (deg, ratio) => {
        const rad = (deg - 90) * Math.PI / 180;
        return [ cx + Math.cos(rad)*R*ratio, cy + Math.sin(rad)*R*ratio ];
      };
      const axes = [
        { k:'t1',    a:   0, l:'Tight (1)' },
        { k:'loose', a: 120, l:'Loose'     },
        { k:'t2',    a: 240, l:'Tight (2)' }
      ];

      // grid
      for(let i=1;i<=rings;i++){
        const ratio = i/rings;
        const pts = axes.map(ax => toXY(ax.a, ratio)).map(p=>p.join(',')).join(' ');
        const g = document.createElementNS(NS,'polygon');
        g.setAttribute('points', pts);
        g.setAttribute('fill', 'none');
        g.setAttribute('stroke', 'rgba(255,255,255,0.12)');
        g.setAttribute('stroke-width', '1');
        svg.appendChild(g);
      }

      // akser + labels
      axes.forEach(ax=>{
        const [x,y] = toXY(ax.a, 1);
        const line = document.createElementNS(NS,'line');
        line.setAttribute('x1', cx); line.setAttribute('y1', cy);
        line.setAttribute('x2', x ); line.setAttribute('y2', y );
        line.setAttribute('stroke', 'rgba(255,255,255,0.18)');
        line.setAttribute('stroke-width', '1');
        svg.appendChild(line);

        const [lx,ly] = toXY(ax.a, 1.15);
        const txt = document.createElementNS(NS,'text');
        txt.setAttribute('x', lx); txt.setAttribute('y', ly);
        txt.setAttribute('fill', '#9aa4b2');
        txt.setAttribute('font-size', '12');
        txt.setAttribute('text-anchor', 'middle');
        txt.textContent = ax.l;
        svg.appendChild(txt);
      });

      // maks-polygon
      const maxPts = axes.map(ax => toXY(ax.a, 1)).map(p=>p.join(',')).join(' ');
      const maxPoly = document.createElementNS(NS,'polygon');
      maxPoly.setAttribute('points', maxPts);
      maxPoly.setAttribute('fill', 'none');
      maxPoly.setAttribute('stroke', 'var(--brand-2)');
      maxPoly.setAttribute('stroke-width', '2');
      svg.appendChild(maxPoly);

      // bruker-polygon
      const clamp25 = v => Math.max(0, Math.min(25, v||0));
      const ratios  = axes.map(ax => clamp25(scores[ax.k]) / 25);
      const userPts = axes.map((ax,i)=> toXY(ax.a, ratios[i]) ).map(p=>p.join(',')).join(' ');
      const userPoly = document.createElementNS(NS,'polygon');
      userPoly.setAttribute('points', userPts);
      userPoly.setAttribute('fill', 'rgba(10,124,255,0.20)');
      userPoly.setAttribute('stroke', 'var(--brand)');
      userPoly.setAttribute('stroke-width', '2');
      svg.appendChild(userPoly);
    }

    // Knapper
    $('#btn-calc').addEventListener('click', ()=>{ updateScoreboxes(true); toast(st.lang==='dk'?'Resultater opdateret':'Resultater oppdatert'); });
    $('#btn-readmore').addEventListener('click', ()=> showPage(5));
    $('#btn-reset').addEventListener('click', ()=>{ if(confirm(st.lang==='dk'?'Nulstil alle svar?':'Nullstill alle svar?')){ st.answers={t1:Array(5).fill(null), loose:Array(5).fill(null), t2:Array(5).fill(null)}; save(); renderAccordion(); updateScoreboxes(false); } });

    function toast(msg){
      const d=document.createElement('div'); d.textContent=msg;
      Object.assign(d.style,{position:'fixed',left:'50%',bottom:'28px',transform:'translateX(-50%)',padding:'10px 14px',background:'#0c1527',color:'#eef2f7',border:'1px solid rgba(255,255,255,.15)',borderRadius:'10px',boxShadow:'0 10px 25px rgba(0,0,0,.35)',zIndex:9999});
      document.body.appendChild(d); setTimeout(()=>d.remove(),1400);
    }

    // Service worker er AV her for å unngå “frys” under testing.
    // Skru PÅ igjen ved å fjerne kommentaren og bump CACHE_NAME i sw.js.
    /*
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }
    */

    // init
    setFlag(); applyLang(); renderAccordion(); load(); showPage(1);
  </script>
</body>
</html>
