<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tight–Loose–Tight Kalkulator</title>

  <!-- iPhone homescreen / PWA hooks -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TLT Kalkulator">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0a7cff" />

  <style>
    :root{
      --brand:#0a7cff; --brand-2:#5cc8ff;
      --bg:#0a0f1a; --card:#101828; --muted:#9aa4b2; --text:#eef2f7;
      --ok:#10b981; --warn:#f59e0b; --bad:#ef4444; --radius:16px; --disabled:#1a2234;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 90% -10%, color-mix(in oklab, var(--brand) 35%, transparent), transparent 60%),
        radial-gradient(1000px 600px at 10% 110%, color-mix(in oklab, var(--brand-2) 35%, transparent), transparent 60%),
        linear-gradient(180deg, #0b1220 0%, #0a0f1a 60%, #070b12 100%);
      min-height:100%;
    }
    .wrap{max-width:980px;margin:0 auto;padding:24px clamp(16px,4vw,28px) 80px}
    header{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:18px;text-align:center}

    /* Større logo (ca. 300% fra utgangspunktet) */
    .logo{width:132px;height:132px;border-radius:12px;background:#0b1322;border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo img{max-width:100%;max-height:100%;object-fit:contain}

    .title{font-size:clamp(26px,4.8vw,38px);font-weight:800;text-align:center}
    .subtitle{color:var(--muted);line-height:1.5}

    .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.07);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.35);backdrop-filter:blur(6px)}
    .card-inner{padding:clamp(16px,2.8vw,24px)}
    .row{display:grid;gap:12px}

    .lang{display:flex;gap:16px;align-items:center;justify-content:center}

    /* Høyoppløste flagg (SVG via CDN) + pen størrelse */
    .flag{
      width:160px;      /* Øk til 192/224 hvis du ønsker enda større */
      height:106px;     /* 3:2-forhold for pene flagg */
      border-radius:8px;
      border:1px solid rgba(255,255,255,.2);
      cursor:pointer;
      opacity:.95;
      background:#0b1322;
    }
    .flag.active{ outline:2px solid var(--brand); opacity:1; }

    .nav-arrows{display:flex;justify-content:space-between;gap:12px;margin-top:18px}
    #p1-prev{display:none} /* fjernet tilbake på side 1 */
    #p5-next{display:none} /* fjernet neste på side 5 */
    .arrow{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0b1322;color:var(--text);cursor:pointer}

    .btn{padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,#0e1a33,#0b1322);color:var(--text);cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(180deg,var(--brand),var(--brand-2));color:#041123;border-color:transparent}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.2)}
    .btn[disabled]{opacity:.5;cursor:not-allowed}

    .field{display:grid;gap:8px}
    input[type="text"]{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1322;color:var(--text);outline:none}
    .name-row{display:flex;gap:10px;align-items:center}
    .pencil{cursor:pointer;opacity:.8}

    .accordion{display:grid;gap:12px}
    .acc-item{border:1px solid rgba(255,255,255,.08);border-radius:14px;background:#0c1527}
    .acc-hd{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;cursor:pointer}
    .acc-hd h3{margin:0;font-size:16px}
    .acc-bd{display:none;padding:0 16px 16px 16px}
    .acc-item.open .acc-bd{display:block}

    .q{padding:12px;border-radius:12px;border:1px dashed rgba(255,255,255,.12);margin-top:10px}
    .q p{margin:0 0 10px 0}
    .scale{display:flex;gap:8px;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;justify-content:center;min-width:42px;padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#0b1322;color:var(--text);cursor:pointer}
    .pill.active{background:color-mix(in oklab, var(--brand) 30%, transparent);border-color:var(--brand)}

    .scorebox{display:grid;gap:10px;grid-template-columns:repeat(3,1fr)}
    .score{text-align:center;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0c1527}
    .score.disabled{background:var(--disabled);opacity:.7}
    .score h4{margin:2px 0 6px 0;color:var(--muted);font-weight:600}
    .score .big{font-size:28px;font-weight:900}
    .badge{font-weight:800;padding:2px 8px;border-radius:999px}
    .ok{background:rgba(16,185,129,.2);color:#d1fae5;border:1px solid rgba(16,185,129,.4)}
    .warn{background:rgba(245,158,11,.2);color:#fef3c7;border:1px solid rgba(245,158,11,.4)}
    .bad{background:rgba(239,68,68,.2);color:#fee2e2;border:1px solid rgba(239,68,68,.4)}

    footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}
    .hidden{display:none!important}

    /* Side 1: senter flagg og tekst */
    #page-1 .row{place-items:center;text-align:center}
    #p1-text{width:100%;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" title="Bytt ut logo.png i repoet for firmalogo">
        <img id="logo" src="logo.png" alt="Company Logo"
             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2244%22 height=%2244%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%230b1322%22/%3E%3Ctext x=%2250%25%22 y=%2256%25%22 text-anchor=%22middle%22 font-size=%2220%22 fill=%22%239aa4b2%22 font-family=%22Arial%22%3ELOGO%3C/text%3E%3C/svg%3E'">
      </div>
      <div class="title">Tight–Loose–Tight</div>
      <div class="subtitle" id="subtitle">Refleksjonsverktøy for lederstil</div>
    </header>

    <div class="card">
      <div class="card-inner">
        <!-- PAGE 1 -->
        <div id="page-1" class="page">
          <div class="row" style="gap:14px">
            <div class="lang">
              <!-- CDN først (SVG), fallback til PNG hvis SVG feiler -->
              <img id="flag-no" class="flag"
                   src="https://flagcdn.com/no.svg" alt="Norsk" title="Norsk"
                   onerror="this.onerror=null;this.src='https://flagcdn.com/w160/no.png'">
              <img id="flag-dk" class="flag"
                   src="https://flagcdn.com/dk.svg" alt="Dansk" title="Dansk"
                   onerror="this.onerror=null;this.src='https://flagcdn.com/w160/dk.png'">
            </div>
            <p id="p1-text" class="subtitle">Velg språk og gå videre.</p>
            <div class="nav-arrows">
              <button class="arrow" id="p1-prev">← Tilbake</button>
              <button class="arrow" id="p1-next">Neste →</button>
            </div>
          </div>
        </div>

        <!-- PAGE 2 -->
        <div id="page-2" class="page hidden">
          <div class="row" style="gap:14px">
            <div class="field">
              <label for="name" id="lbl-name">Skriv inn ditt navn</label>
              <div class="name-row">
                <input id="name" type="text" placeholder="Skriv navnet ditt…" />
                <button class="btn ghost" id="btn-ok">OK</button>
                <span id="btn-edit" class="pencil" title="Rediger" aria-label="Rediger navn">✎</span>
              </div>
              <small class="subtitle" id="p2-help">Navnet lagres lokalt på enheten og brukes i resultatene.</small>
            </div>
            <div class="nav-arrows">
              <button class="arrow" id="p2-prev">← Tilbake</button>
              <button class="arrow" id="p2-next">Neste →</button>
            </div>
          </div>
        </div>

        <!-- PAGE 3 -->
        <div id="page-3" class="page hidden">
          <h2 id="p3-title">Test deg selv</h2>
          <div class="accordion" id="acc"></div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
            <button class="btn primary" id="btn-calc">Oppdater resultater</button>
            <button class="btn" id="btn-readmore">Les mer</button>
            <button class="btn ghost" id="btn-reset">Nullstill</button>
          </div>
          <div class="scorebox" style="margin-top:14px">
            <div class="score disabled" id="sb-t1">
              <h4>Tight (1)</h4><div class="big" id="sbv-t1">–</div><div class="muted" id="sbb-t1">–</div>
            </div>
            <div class="score disabled" id="sb-loose">
              <h4>Loose</h4><div class="big" id="sbv-loose">–</div><div class="muted" id="sbb-loose">–</div>
            </div>
            <div class="score disabled" id="sb-t2">
              <h4>Tight (2)</h4><div class="big" id="sbv-t2">–</div><div class="muted" id="sbb-t2">–</div>
            </div>
          </div>
          <div class="nav-arrows">
            <button class="arrow" id="p3-prev">← Tilbake</button>
            <button class="arrow" id="p3-next">Neste →</button>
          </div>
        </div>

        <!-- PAGE 4 -->
        <div id="page-4" class="page hidden">
          <h2 id="p4-title">Her er dine resultater <span id="userNameInline"></span></h2>
          <div class="scorebox" style="margin:10px 0 16px 0;grid-template-columns:1fr">
            <div class="score disabled" id="r-t1">
              <h4>Tight (1)</h4><div class="big" id="rv-t1">–</div><div class="muted" id="rb-t1">–</div>
              <p id="rt-t1" class="subtitle" style="margin-top:8px"></p>
            </div>
            <div class="score disabled" id="r-loose">
              <h4>Loose</h4><div class="big" id="rv-loose">–</div><div class="muted" id="rb-loose">–</div>
              <p id="rt-loose" class="subtitle" style="margin-top:8px"></p>
            </div>
            <div class="score disabled" id="r-t2">
              <h4>Tight (2)</h4><div class="big" id="rv-t2">–</div><div class="muted" id="rb-t2">–</div>
              <p id="rt-t2" class="subtitle" style="margin-top:8px"></p>
            </div>
          </div>
          <div class="nav-arrows">
            <button class="arrow" id="p4-prev">← Tilbake</button>
            <button class="arrow" id="p4-next">Neste →</button>
          </div>
        </div>

        <!-- PAGE 5 -->
        <div id="page-5" class="page hidden">
          <h2 id="p5-title">Kort om TLT</h2>
          <div class="card" style="margin:10px 0">
            <div class="card-inner">
              <div id="info-text" class="subtitle"></div>
              <div style="overflow:auto;margin-top:14px">
                <table id="info-table" style="width:100%;border-collapse:separate;border-spacing:0 8px"></table>
              </div>
            </div>
          </div>
          <div class="nav-arrows">
            <button class="arrow" id="p5-prev">← Tilbake</button>
            <button class="arrow" id="p5-next">Neste →</button>
          </div>
        </div>
        <!-- END PAGES -->
      </div>
    </div>

    <footer id="ft">Tips: Legg på hjem-skjerm via Del → «Legg til på Hjem-skjerm».</footer>
  </div>

  <script>
    // ---- Localization ----
    const L = {
      no: {
        subtitle:"Refleksjonsverktøy for lederstil",
        p1:"Velg språk og gå videre.",
        nameLbl:"Skriv inn ditt navn",
        nameHelp:"Navnet lagres lokalt på enheten og brukes i resultatene.",
        testYourself:"Test deg selv", update:"Oppdater resultater", readmore:"Les mer", reset:"Nullstill",
        resultsTitle:(n)=>`Her er dine resultater${n?` (${n})`:''}`, infoTitle:"Kort om TLT",
        badges:{ strong:"Sterk", balanced:"Balansert", weak:"Svak" },
        table:[
          ["Fase","Hva betyr det?","Ditt fokus"],
          ["Tight (start)","Tydelig retning, mål, roller og standarder.","Klare mål, prioriteringer og forventninger."],
          ["Loose (midt)","Autonomi og eierskap i teamet.","Skap trygghet, psykologisk sikkerhet og frihet i rammene."],
          ["Tight (slutt)","Oppfølging, kvalitet og læring.","Hyppig review, korrigering og feiring av fremdrift."]
        ],
      },
      dk: {
        subtitle:"Refleksionsværktøj for lederstil",
        p1:"Vælg sprog og gå videre.",
        nameLbl:"Skriv dit navn",
        nameHelp:"Navnet gemmes lokalt på enheden og bruges i resultaterne.",
        testYourself:"Test dig selv", update:"Opdater resultater", readmore:"Læs mere", reset:"Nulstil",
        resultsTitle:(n)=>`Her er dine resultater${n?` (${n})`:''}`, infoTitle:"Kort om TLT",
        badges:{ strong:"Stærk", balanced:"Afbalanceret", weak:"Svæk" },
        table:[
          ["Fase","Hvad betyder det?","Dit fokus"],
          ["Tight (start)","Tydelig retning, mål, roller og standarder.","Klarhed i mål, prioriteringer og forventninger."],
          ["Loose (midt)","Autonomi og ejerskab i teamet.","Skab tryghed og frihed inden for rammerne."],
          ["Tight (slut)","Opfølgning, kvalitet og læring.","Hyppig review, korrektion og fejring af fremdrift."]
        ],
      }
    };

    // ---- Questions ----
    const QUESTIONS = {
      t1:[
        "Jeg sikrer at teamet forstår mål, prioriteringer og forventede leveranser.",
        "Jeg definerer roller og ansvar slik at alle vet sitt bidrag.",
        "Jeg kommuniserer standarder, frister og kvalitetskrav tydelig."
      ],
      loose:[
        "Jeg gir frihet til å løse oppgaver innenfor avtalte rammer.",
        "Jeg skaper trygghet for å eksperimentere, ta risiko og foreslå nye ideer.",
        "Jeg stoler på at teamet tar beslutninger selvstendig, og griper kun inn ved behov."
      ],
      t2:[
        "Jeg følger opp progresjon systematisk og gir konstruktive tilbakemeldinger.",
        "Jeg sikrer at leveranser holder avtalte standarder, og adresserer avvik raskt.",
        "Jeg feirer prestasjoner og bruker utfordringer til læring og forbedring."
      ]
    };

    // ---- Evaluation texts ----
    function evalText(section, score, name, lang='no'){
      const weak = score < 8, strong = score >= 12;
      const n = name || "Du";
      const T = {
        no:{
          t1:{
            weak: `${n}, start-Tight trenger å strammes inn. Gjør målene tydelige, avklar roller/ansvar og sett konkrete kvalitetskrav.`,
            mid: `${n}, grunnmuren er der. Forsterk presisjonen: tydeligere prioritering, «definition of done», og en enkel sjekkliste før oppstart.`,
            strong: `${n}, meget tydelig retning. Pass på at presis styring ikke kveler initiativ – sjekk at teamet forstår «hvorfor», ikke bare «hva».`
          },
          loose:{
            weak: `${n}, gi reell autonomi: la teamet velge metode og rekkefølge innenfor rammene. Skap trygghet for eksperimenter og små feil.`,
            mid: `${n}, balanse på vei. Utvid psykologisk sikkerhet: spør «hva trenger dere av meg for å lykkes?» og fjern 1–2 friksjoner hver uke.`,
            strong: `${n}, sterk autonomi og tillit. Sikre at friheten kobles til effekt: korte læringssløyfer, demoer og tydelig verdihypotese per tiltak.`
          },
          t2:{
            weak: `${n}, styrk avslutningen: jevnlige reviews, måling mot mål, rask håndtering av avvik og læringspunkter.`,
            mid: `${n}, god oppfølging. Løft kvaliteten ytterligere med standardiserte leveranse-kriterier og tydelig «neste steg» etter hver review.`,
            strong: `${n}, eksemplarisk oppfølging og læring. Vokt deg for overkontroll – hold fokus på læring, effekt og kontinuerlig forbedring.`
          }
        },
        dk:{
          t1:{
            weak: `${n}, start-Tight skal skærpes. Gør mål tydelige, afklar roller/ansvar og sæt konkrete kvalitetskrav.`,
            mid: `${n}, grundlaget er der. Skru op for præcisionen: tydelig prioritering og en kort checklist før opstart.`,
            strong: `${n}, meget tydelig retning. Pas på, at styringen ikke kvæler initiativ – sikre at teamet forstår «hvorfor», ikke kun «hvad».`
          },
          loose:{
            weak: `${n}, giv reel autonomi: lad teamet vælge metode og rækkefølge inden for rammerne. Skab tryghed for eksperimenter og små fejl.`,
            mid: `${n}, balancen er på vej. Udvid psykologisk tryghed: spørg «hvad har I brug for fra mig?» og fjern 1–2 friktioner hver uge.`,
            strong: `${n}, stærk autonomi og tillid. Sørg for at friheden kobles til effekt: korte læringsloops, demoer og tydelig værdihypotese per tiltag.`
          },
          t2:{
            weak: `${n}, styrk afslutningen: faste reviews, måling mod mål, hurtig håndtering af afvigelser og læringspunkter.`,
            mid: `${n}, god opfølgning. Hæv kvaliteten med standardiserede leverance-kriterier og klare «næste skridt» efter hver review.`,
            strong: `${n}, forbilledlig opfølgning og læring. Undgå overkontrol – hold fokus på læring, effekt og løbende forbedring.`
          }
        }
      };
      const key = weak ? 'weak' : (strong ? 'strong' : 'mid');
      return T[lang][section][key];
    }

    // ---- State ----
    const STATE_KEY = 'tlt_calc_v2_multi';
    let st = { lang:'no', name:'', answers:{ t1:[null,null,null], loose:[null,null,null], t2:[null,null,null] }, expanded:{t1:false,loose:false,t2:false} };
    const $=q=>document.querySelector(q), $$=q=>Array.from(document.querySelectorAll(q));
    function save(){ localStorage.setItem(STATE_KEY, JSON.stringify(st)); }
    function load(){
      try{ const raw = localStorage.getItem(STATE_KEY); if(raw) st = JSON.parse(raw); }catch{}
      applyLang();
      $('#name').value = st.name || '';
      $('#userNameInline').textContent = st.name? st.name : '';
      renderAccordion();
      Object.entries(st.answers).forEach(([k,arr])=>arr.forEach((v,i)=>{ if(v){ const el=document.querySelector(`.pill[data-q="${k}-${i}"][data-v="${v}"]`); if(el) el.classList.add('active'); } }));
      updateScoreboxes(false);
    }

    function applyLang(){
      const t=L[st.lang];
      $('#subtitle').textContent=t.subtitle;
      $('#p1-text').textContent=t.p1;
      $('#lbl-name').textContent=t.nameLbl;
      $('#p2-help').textContent=t.nameHelp;
      $('#p3-title').textContent=t.testYourself;
      $('#btn-calc').textContent=t.update;
      $('#btn-readmore').textContent=t.readmore;
      $('#btn-reset').textContent=t.reset;
      $('#p5-title').textContent=t.infoTitle;
      const tbl=$('#info-table'); tbl.innerHTML='';
      L[st.lang].table.forEach((row,ri)=>{
        const tr=document.createElement('tr');
        row.forEach((cell,ci)=>{
          const td=document.createElement(ri===0?'th':'td');
          td.textContent=cell;
          td.style.padding='10px 12px'; td.style.border='1px solid rgba(255,255,255,.08)';
          td.style.background=ri===0? '#0b1322':'#0c1527'; td.style.color=ri===0? '#9aa4b2':'#eef2f7';
          td.style.textAlign='left'; td.style.borderRadius='8px';
          tr.appendChild(td);
        }); tbl.appendChild(tr);
      });
    }

    // Nav mellom sider
    function showPage(i){ $$('.page').forEach((p,idx)=>p.classList.toggle('hidden', idx!==i-1)); }
    // Språkvalg
    document.addEventListener('click', (e)=>{
      if(e.target && e.target.id==='flag-no'){ st.lang='no'; save(); applyLang(); document.getElementById('flag-no').classList.add('active'); document.getElementById('flag-dk').classList.remove('active'); }
      if(e.target && e.target.id==='flag-dk'){ st.lang='dk'; save(); applyLang(); document.getElementById('flag-dk').classList.add('active'); document.getElementById('flag-no').classList.remove('active'); }
    });
    function setFlag(){ document.getElementById('flag-no')?.classList.toggle('active', st.lang==='no'); document.getElementById('flag-dk')?.classList.toggle('active', st.lang==='dk'); }

    // Navigasjon
    document.getElementById('p1-next').addEventListener('click', ()=> showPage(2));
    document.getElementById('p2-prev').addEventListener('click', ()=> showPage(1));
    document.getElementById('p2-next').addEventListener('click', ()=> showPage(3));
    document.getElementById('p3-prev').addEventListener('click', ()=> showPage(2));
    document.getElementById('p3-next').addEventListener('click', ()=> showPage(4));
    document.getElementById('p4-prev').addEventListener('click', ()=> showPage(3));
    document.getElementById('p4-next').addEventListener('click', ()=> showPage(5));
    document.getElementById('p5-prev').addEventListener('click', ()=> showPage(4));

    // Navn
    document.getElementById('btn-ok').addEventListener('click', ()=>{ st.name=document.getElementById('name').value.trim(); save(); document.getElementById('userNameInline').textContent=st.name||''; toast(st.lang==='dk'?'Navn opdateret':'Navn oppdatert'); });
    document.getElementById('btn-edit').addEventListener('click', ()=>{ document.getElementById('name').focus(); document.getElementById('name').select(); });

    // Accordion
    function renderAccordion(){
      const acc=document.getElementById('acc'); acc.innerHTML='';
      [['t1','Tight (1)'],['loose','Loose'],['t2','Tight (2)']].forEach(([key,label])=>{
        const it=document.createElement('div'); it.className='acc-item'+(st.expanded[key]?' open':'');
        it.innerHTML = `
          <div class="acc-hd" data-key="${key}"><h3>${label}</h3><span>${st.expanded[key]?'−':'+'}</span></div>
          <div class="acc-bd">
            ${QUESTIONS[key].map((text,idx)=>`
              <div class="q">
                <p><strong>${idx+1}.</strong> ${text}</p>
                <div class="scale" role="group" aria-label="Skala for ${key}-${idx}">
                  ${[1,2,3,4,5].map(v=>`<span class="pill" data-q="${key}-${idx}" data-v="${v}" tabindex="0">${v}</span>`).join('')}
                </div>
              </div>
            `).join('')}
          </div>`;
        acc.appendChild(it);
      });
    }

    document.body.addEventListener('click',(e)=>{
      const hd=e.target.closest('.acc-hd');
      if(hd){ const k=hd.dataset.key; st.expanded[k]=!st.expanded[k]; save(); renderAccordion();
        Object.entries(st.answers).forEach(([key,arr])=>arr.forEach((v,i)=>{ if(v){ const el=document.querySelector(`.pill[data-q="${key}-${i}"][data-v="${v}"]`); if(el) el.classList.add('active'); } }));
        return;
      }
      const pill=e.target.closest('.pill');
      if(pill){ const q=pill.dataset.q, v=Number(pill.dataset.v);
        document.querySelectorAll(`.pill[data-q="${q}"]`).forEach(p=>p.classList.remove('active'));
        pill.classList.add('active');
        const [key,idx]=q.split('-'); st.answers[key][Number(idx)]=v; save(); return;
      }
    });

    function sum(a){return a.reduce((x,v)=>x+(Number(v)||0),0);}
    function badge(score){ if(score>=12) return {t:L[st.lang].badges.strong, cls:'ok'}; if(score>=8) return {t:L[st.lang].badges.balanced, cls:'warn'}; return {t:L[st.lang].badges.weak, cls:'bad'}; }

    function updateScoreboxes(hideQuestions){
      const s1=sum(st.answers.t1), sL=sum(st.answers.loose), s2=sum(st.answers.t2);
      [['t1',s1],['loose',sL],['t2',s2]].forEach(([k,s])=>{
        const sb=document.getElementById('sb-'+k), sbb=document.getElementById('sbb-'+k), sbv=document.getElementById('sbv-'+k);
        if(s>0){ sb.classList.remove('disabled'); const b=badge(s); sbb.innerHTML=`<span class="badge ${b.cls}">${b.t}</span>`; sbv.textContent=`${s}/15`; }
        else { sb.classList.add('disabled'); sbb.textContent='–'; sbv.textContent='–'; }
      });
      if(hideQuestions){ st.expanded={t1:false,loose:false,t2:false}; save(); renderAccordion(); }
      fillResultsPage();
    }

    function fillResultsPage(){
      const scores={ t1:sum(st.answers.t1), loose:sum(st.answers.loose), t2:sum(st.answers.t2) };
      document.getElementById('userNameInline').textContent=st.name||'';
      Object.entries(scores).forEach(([k,s])=>{
        const r=document.getElementById('r-'+k), rv=document.getElementById('rv-'+k), rb=document.getElementById('rb-'+k), rt=document.getElementById('rt-'+k);
        if(s>0){ r.classList.remove('disabled'); const b=badge(s); rb.innerHTML=`<span class="badge ${b.cls}">${b.t}</span>`; rv.textContent=`${s}/15`; rt.textContent=evalText(k,s,st.name,st.lang); }
        else { r.classList.add('disabled'); rb.textContent='–'; rv.textContent='–'; rt.textContent=''; }
      });
    }

    document.getElementById('btn-calc').addEventListener('click', ()=>{ updateScoreboxes(true); toast(st.lang==='dk'?'Resultater opdateret':'Resultater oppdatert'); });
    document.getElementById('btn-readmore').addEventListener('click', ()=> showPage(4));
    document.getElementById('btn-reset').addEventListener('click', ()=>{ if(confirm(st.lang==='dk'?'Nulstil alle svar?':'Nullstill alle svar?')){ st.answers={t1:[null,null,null], loose:[null,null,null], t2:[null,null,null]}; save(); renderAccordion(); updateScoreboxes(false); } });

    function toast(msg){ const d=document.createElement('div'); d.textContent=msg; Object.assign(d.style,{position:'fixed',left:'50%',bottom:'28px',transform:'translateX(-50%)',padding:'10px 14px',background:'#0c1527',color:'#eef2f7',border:'1px solid rgba(255,255,255,.15)',borderRadius:'10px',boxShadow:'0 10px 25px rgba(0,0,0,.35)',zIndex:9999}); document.body.appendChild(d); setTimeout(()=>d.remove(),1400); }

    // Service worker midlertidig AV (unngå frys mens vi tester)
    /* if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    } */

    // init
    setFlag(); applyLang(); renderAccordion(); load(); showPage(1);
  </script>
</body>
</html>
